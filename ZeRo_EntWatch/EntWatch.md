# ZeRo_EntWatch 神器配置指南 (基于实际代码)

## 目录
- [配置文件位置](#配置文件位置)
- [配置文件结构](#配置文件结构)
- [配置参数详解](#配置参数详解)
- [实际使用示例](#实际使用示例)
- [技能模式说明](#技能模式说明)
- [实体类型支持](#实体类型支持)
- [调试和故障排除](#调试和故障排除)

## 配置文件位置

配置文件位于: `configs/plugins/ZeRo_ZEModule/ZeRo_EntWatch/`

文件命名格式: `地图名.json` (例如: `ze_minecraft_adventure.json`)

## 配置文件结构

```json
{
  "武器HammerID": {
    "Id": "武器HammerID",
    "Name": "神器显示名称",
    "Skills": [
      {
        "Id": "按钮HammerID",
        "Name": "技能名称",
        "Cooldown": 冷却时间(秒),
        "MaxUses": 最大使用次数,
        "Mode": 技能模式
      }
    ]
  }
}
```

## 配置参数详解

### 武器配置 (Weapon)

| 参数 | 类型 | 必填 | 描述 | 示例 |
|------|------|------|------|------|
| `Id` | string | 是 | 武器实体的Hammer ID | `"12345"` |
| `Name` | string | 是 | 武器显示名称 | `"Aegis盾"` |
| `Skills` | array | 是 | 技能列表 | `[技能配置]` |

### 技能配置 (Skill)

| 参数 | 类型 | 必填 | 描述 | 示例 |
|------|------|------|------|------|
| `Id` | string | 是 | 按钮实体的Hammer ID | `"12346"` |
| `Name` | string | 是 | 技能显示名称 | `"护盾"` |
| `Cooldown` | int | 是 | 冷却时间(秒) | `60` |
| `MaxUses` | int | 是 | 最大使用次数(-1为无限) | `3` |
| `Mode` | int | 是 | 技能模式(0-4) | `2` |

## 实际使用示例

### ze_example_map.json

```json
{
  "12345": {
    "Id": "12345",
    "Name": "Aegis盾",
    "Skills": [
      {
        "Id": "12346",
        "Name": "护盾技能",
        "Cooldown": 45,
        "MaxUses": 3,
        "Mode": 2
      }
    ]
  },
  "12347": {
    "Id": "12347",
    "Name": "火焰枪",
    "Skills": [
      {
        "Id": "12348",
        "Name": "火焰射击",
        "Cooldown": 15,
        "MaxUses": -1,
        "Mode": 1
      }
    ]
  },
  "12349": {
    "Id": "12349",
    "Name": "治疗枪",
    "Skills": [
      {
        "Id": "12350",
        "Name": "群体治疗",
        "Cooldown": 60,
        "MaxUses": 5,
        "Mode": 2
      }
    ]
  }
}
```

## 技能模式说明

### Mode 值对应功能

| Mode值 | 功能描述 | 使用次数 | 冷却时间 |
|--------|----------|----------|----------|
| `0` | 一次性使用 | 1次 | 无 |
| `1` | 仅冷却时间 | 无限 | 有 |
| `2` | 冷却+次数限制 | 有限 | 有 |
| `3` | 移除后禁用 | 有限 | 有 |
| `4` | 无限制 | 无限 | 无 |

### 推荐配置

```json
// 防御类神器 - 有限次数+冷却
{
  "Id": "按钮ID",
  "Name": "护盾",
  "Cooldown": 60,
  "MaxUses": 3,
  "Mode": 2
}

// 攻击类神器 - 仅冷却
{
  "Id": "按钮ID", 
  "Name": "火球术",
  "Cooldown": 20,
  "MaxUses": -1,
  "Mode": 1
}

// 辅助类神器 - 一次性
{
  "Id": "按钮ID",
  "Name": "传送",
  "Cooldown": 0,
  "MaxUses": 1,
  "Mode": 0
}
```

## 实体类型支持

### 支持的按钮实体类型

1. **func_button** - 标准按钮
2. **func_rot_button** - 旋转按钮  
3. **func_door** - 门(需要Spawnflags 256)
4. **func_door_rotating** - 旋转门(需要Spawnflags 256)
5. **func_physbox** - 物理盒子

### 武器实体
- 所有 `weapon_*` 实体都会被自动检测

## 调试和故障排除

### 常见问题

#### 1. 神器不被识别
```json
// ❌ 错误 - 缺少顶层对象
[
  {
    "Id": "12345"
  }
]

// ✅ 正确 - 使用HammerID作为键
{
  "12345": {
    "Id": "12345",
    "Name": "神器名称"
  }
}
```

#### 2. 技能无法使用
```json
// ❌ 错误 - Id类型不匹配
{
  "Id": 12345,  // 应该是字符串
  "Skills": [
    {
      "Id": 12346  // 应该是字符串
    }
  ]
}

// ✅ 正确
{
  "Id": "12345",
  "Skills": [
    {
      "Id": "12346"
    }
  ]
}
```

### 调试方法

#### 1. 查看聊天输出
- 捡起神器: `[神器检测] 玩家名 捡起了 神器名`
- 使用技能: `[神器检测] 玩家名 使用了神器 技能名`
- 按钮检测: `[按钮检测] 玩家名 按下了 #按钮ID_按钮名`

#### 2. 查看控制台日志
```bash
# 启用详细日志
sv_cheats 1
developer 1
```

#### 3. 手动重载配置
```bash
# 重启地图或服务器来重新加载配置
```

### 配置验证

```json
// 完整验证示例
{
  "361240": {
    "Id": "361240",
    "Name": "神圣护盾",
    "Skills": [
      {
        "Id": "361241",
        "Name": "启动护盾",
        "Cooldown": 60,
        "MaxUses": 3,
        "Mode": 2
      }
    ]
  }
}
```

### 获取Hammer ID方法

1. 在Hammer编辑器中查看实体的 `Entity Index`
2. 游戏中使用实体检测工具
3. 查看服务器日志中的按钮检测信息

---
*配置文件会自动创建和更新，首次运行时会生成基础配置模板。*